import Head from "next/head";
import Card from "../components/Card";
import Image from "next/image";
import Link from "next/link";
import ModalChangeLog from "../components/ModalChangeLog";
export interface QuotesTypes {
  _id: string;
  author: string;
  content: string;
  tags: string[];
  deleteQuote: boolean;
  likesCount: number;
  count: number;
}

export default function Home({
  topQuotes,
  topAuthor,
}: {
  topQuotes: [];
  topAuthor: [];
}) {
  return (
    <>
      <Head>
        <title>YouReadIt?</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <ModalChangeLog />
      <h1
        style={{
          display: "flex",
          justifyContent: "center",
          marginBottom: "3rem",
        }}
      >
        Quotes Of the Day
      </h1>

      <section
        style={{
          display: "flex",
          width: "95%",
          height: "95%",
          margin: "auto",
          flexWrap: "wrap",
          justifyContent: "space-around",
        }}
      >
        <div
          style={{
            width: "380px",
            height: "380px",
            borderRadius: "20px",
            backgroundColor: "rgba(16,16,16)",
            border: "1px white solid",
            marginBottom: "1rem",
          }}
        >
          <h2
            style={{
              paddingTop: "1rem",
              display: "flex",
              justifyContent: "center",
              marginBottom: "8rem",
            }}
          >
            Most Liked Quotes
          </h2>
          <div
            style={{
              height: "0%",
              paddingTop: "1rem",
              display: "flex",
              justifyContent: "center",
            }}
          >
            <div style={{ height: "0%" }}>
              {topQuotes.map((quote: QuotesTypes) => (
                <div key={quote._id} className="carousel__item">
                  <Card quotes={quote} deleteQuote={false} />
                </div>
              ))}
            </div>
          </div>
        </div>
        <div
          style={{
            width: "380px",
            height: "380px",
            borderRadius: "20px",
            backgroundColor: "rgba(16,16,16)",
            border: "1px white solid",
          }}
        >
          <h2
            style={{
              paddingTop: "1rem",
              display: "flex",
              justifyContent: "center",
              marginBottom: "1rem",
            }}
          >
            Top Authors
          </h2>
          <div
            style={{
              paddingTop: "1rem",
              display: "flex",
              justifyContent: "center",
            }}
          >
            <div style={{ width: "80%" }}>
              {topAuthor.map((quote: QuotesTypes) => (
                <div key={quote._id}>
                  <Link
                    style={{ color: "white" }}
                    href={`/category/author/${quote._id}`}
                  >
                    <h3
                      style={{
                        display: "flex",
                        justifyContent: "space-evenly",
                      }}
                    >
                      {quote._id}
                      <div>
                        {quote.count}
                        <Image
                          src="/icons/dislike.svg"
                          width={25}
                          height={20}
                          alt="icon heart"
                        />
                      </div>
                    </h3>
                  </Link>
                </div>
              ))}
            </div>
          </div>
        </div>
      </section>
    </>
  );
}

export async function getServerSideProps() {
  try {
    const res = await fetch(
      `${process.env.NEXTAUTH_URL}/api/auth/quotes?limit=9&top=1`
    );
    const resauthor = await fetch(
      `${process.env.NEXTAUTH_URL}/api/auth/quotes?limit=5&topAuthor=1`
    );
    const topAuthor = await resauthor.json();
    const topQuotes = await res.json();
    return {
      props: {
        topQuotes,
        topAuthor,
      },
    };
  } catch (error) {
    console.log(error);
  }
}
